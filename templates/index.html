<!-- index.html (Login) -->
{% extends 'base.html' %}
{% set show_navbar = false %}
{% block title %}Login | MovieReservation{% endblock %}
{% block content %}
<div class="auth-wrapper">
    
    <div class="auth-logo">
        <img src="{{ url_for('static', filename='images/Website_Logo.png') }}"
             alt="FlickBook Logo" class="auth-logo__img">
    </div>

    <div class="login">
        <h2 class="login__title">Welcome</h2>
        <form id="landing-login-form" class="login__form">
            <input class="login__input" type="text" name="username" placeholder="Username" required>
            <input class="login__input" type="password" name="password" placeholder="Password" required>
            <button class="login__button" type="submit">Login</button>
        </form>

        <p class="login__message" id="landing-login-message"></p>

        <p>Don't have an account? <a href="{{ url_for('auth.register') }}">Register here</a></p>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
  const loginForm = document.getElementById('landing-login-form');
  const loginMessage = document.getElementById('landing-login-message');

  loginForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    const formData = new FormData(loginForm);
    const data = Object.fromEntries(formData);

    try {
      const response = await fetch("{{ url_for('auth.login') }}", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "same-origin",
        body: JSON.stringify(data),
      });

      const result = await response.json();
      loginMessage.textContent = result.message || '';

      if (response.ok && result.token) {
        localStorage.setItem('jwt', result.token);
        window.location.href = "{{ url_for('home') }}";
      } else {
        localStorage.removeItem('jwt');
      }
    } catch (error) {
      loginMessage.textContent = "Login failed. Please try again.";
      localStorage.removeItem('jwt');
    }
  });
</script>
{% endblock %}
